<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KT Insight Reports</title>

  <!-- Optional: basic styling reset -->
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
  </style>
</head>

<body>
  <!-- =========================
       PASSWORD LOGIN GATE START
       ========================= -->
  <div id="login-gate" style="
    position: fixed; inset: 0; background: white; z-index: 9999;
    display: grid; place-items: center; padding: 24px; font-family: sans-serif;
  ">
    <form id="login-form" style="
      width: 360px; max-width: 90vw; border: 1px solid #ddd;
      border-radius: 12px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.06);
    ">
      <h2 style="margin: 0 0 8px;">KT Insight Reports</h2>
      <p style="margin: 0 0 12px; color:#444;">
        Enter the shared password to continue.
      </p>

      <input id="login-password" type="password" placeholder="Password" style="
        width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc;
        margin-bottom: 8px; font-size: 14px;
      "/>

      <div id="login-error" style="color: crimson; margin-bottom: 8px; display:none;"></div>

      <button type="submit" style="
        width: 100%; padding: 10px; border-radius: 8px; border: none;
        cursor: pointer; font-size: 15px; font-weight: 600;
      ">Unlock</button>

      <p style="margin:12px 0 0; font-size: 12px; color:#777; text-align:center;">
        Contact admin if you need access.
      </p>
    </form>
  </div>

  <script>
  (async function () {
    const gate = document.getElementById("login-gate");
    const form = document.getElementById("login-form");
    const input = document.getElementById("login-password");
    const err = document.getElementById("login-error");

    // 1) Check session cookie via server
    try {
      const r = await fetch("/api/session");
      const j = await r.json();
      if (j.ok) {
        gate.style.display = "none";
        return;
      }
    } catch (e) {
      // ignore; user will log in
    }

    // 2) Handle password submit
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      err.style.display = "none";

      const password = input.value.trim();
      if (!password) return;

      try {
        const r = await fetch("/api/auth", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ password })
        });

        if (r.ok) {
          gate.style.display = "none";
        } else {
          err.textContent = "Incorrect password.";
          err.style.display = "block";
        }
      } catch (e) {
        err.textContent = "Login failed. Try again.";
        err.style.display = "block";
      }
    });
  })();
  </script>
  <!-- =======================
       PASSWORD LOGIN GATE END
       ======================= -->


  <!-- =========================================
       YOUR EXISTING PAGE CONTENT START
       Paste your old index.html <body> here.
       ========================================= -->

  <main style="max-width: 900px; margin: 0 auto; padding: 24px;">
    <header style="display:flex; align-items:center; gap:12px; margin-bottom: 20px;">
      <!-- Update image path if needed -->
      <img src="EOTC.png" alt="EOTC" style="width:56px; height:56px; object-fit:contain;" />
      <div>
        <h1 style="margin:0; font-size: 22px;">Report Violence Against the EOTC</h1>
        <p style="margin:4px 0 0; color:#555;">
          Submit incidents. Approved users only.
        </p>
      </div>
    </header>

    <!-- Example form wrapper; replace with your real content -->
    <section id="app-root">
      <!-- If you had a form / JS-driven UI, keep your original markup here -->
      <p style="color:#777;">(Paste your original page content here.)</p>
    </section>
  </main>

  <!-- =======================================
       YOUR EXISTING PAGE CONTENT END
       ======================================= -->

</body>
</html>
