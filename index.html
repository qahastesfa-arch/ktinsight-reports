<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ethiopian Orthodox Church Incident Reporting</title>

  <!-- Ethiopic-friendly font -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Ethiopic:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#1a1a1a; --panel:#2b2b2b; --text:#f5f5f5; --muted:#e0e0e0;
      --gold:#f0d68a; --red:#8c1111; --red-2:#b11b1b; --stroke:#555;
    }
    body {
      font-family: Inter, "Noto Sans Ethiopic", Arial, sans-serif;
      background-color: var(--bg);
      color: var(--text);
      margin: 0;
    }
    header {
      text-align: center;
      background: linear-gradient(180deg, #4b0000 0%, #2a0000 100%);
      color: var(--text);
      padding: 24px 16px;
      border-bottom: 2px solid var(--red);
      position: sticky; top: 0; z-index: 5;
    }
    .topbar { display: flex; gap: 12px; align-items: center; justify-content: center; margin-bottom: 8px; }
    .lang-select {
      background: #220000;
      color: #fff;
      border: 1px solid #4a0d0d;
      border-radius: 6px;
      padding: 6px 10px;
      font-size: 0.95rem;
    }
    img.logo {
      max-width: 240px;
      height: auto;
      margin: 6px 0 10px;
      filter: grayscale(20%) contrast(120%);
    }
    h1, h2 { text-align: center; color: var(--gold); margin: 6px 0 0; }
    main {
      max-width: 680px;
      margin: 40px auto;
      background: var(--panel);
      padding: 28px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }
    p { line-height: 1.6; color: var(--muted); }
    form label { display:block; margin-top:15px; font-weight: 600; color: var(--gold); }
    input, textarea, select {
      width:100%;
      padding:10px;
      margin-top:6px;
      border-radius:6px;
      border:1px solid var(--stroke);
      background:#1e1e1e;
      color:var(--text);
      font-size:1rem;
    }
    input:focus, textarea:focus { outline:2px solid var(--red); background:#262626; }
    button {
      background: var(--red);
      color:#fff;
      border:none;
      padding:12px 20px;
      font-size:1rem;
      border-radius:8px;
      margin-top:22px;
      cursor:pointer;
      width:100%;
    }
    button:hover { background: var(--red-2); }
    .helper { font-size: 0.9rem; color:#bbb; margin-top: 8px; }
    footer { text-align:center; margin:50px 0 20px; font-size:0.9rem; color:#999; }

    /* Status messages */
    .status-ok,
    .status-err {
      display:none;
      margin-top:12px;
      padding:10px 12px;
      border-radius:6px;
      font-size:0.95rem;
      font-weight:600;
    }
    .status-ok {
      background:#1f3b1f;
      border:1px solid #3f7f3f;
      color:#c8f7c5;
    }
    .status-err {
      background:#4b1111;
      border:1px solid #c0392b;
      color:#ffd6d6;
    }
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <label for="lang" style="font-weight:600;">üåê</label>
      <select id="lang" class="lang-select" aria-label="Language">
        <option value="en">English</option>
        <option value="am">·ä†·àõ·à≠·äõ</option>
      </select>
    </div>

    <img src="https://raw.githubusercontent.com/qahastesfa-arch/ktinsight-reports/main/EOTC.png"
         alt="Ethiopian Orthodox Church Logo" class="logo">
    <h1 data-i18n="title"> Report Violence Against the Ethiopian Orthodox Church </h1>
  </header>

  <main>
    <h2 data-i18n="subtitle">Incident Reporting Portal</h2>
    <p data-i18n="intro">
      This site collects reports of violence, persecution, or vandalism directed against Ethiopian Orthodox
      Church worshippers, priests, and church property. Please provide as much detail as possible.
    </p>

    <form id="report-form" method="post" action="#">
      <label><span data-i18n="date_label">Date of Incident</span>:
        <input type="date" name="incident_date" required>
      </label>

      <label><span data-i18n="location_label">Location (City/Region)</span>:
        <input type="text" name="location" placeholder="e.g. Gondar, Amhara" required data-ph="location_ph">
      </label>

      <label><span data-i18n="reporting_country_label">Country You Are Reporting From</span>:
        <input type="text" name="reporting_country" placeholder="e.g. United States, Ethiopia" required data-ph="country_ph">
      </label>

      <!-- OPTIONAL -->
      <label><span data-i18n="name_label">Your Full Name (optional)</span>:
        <input type="text" name="reporter_name" placeholder="Full name" data-ph="name_ph">
      </label>

      <!-- OPTIONAL -->
      <label><span data-i18n="phone_label">Phone Number (optional)</span>:
        <input type="tel" name="phone" placeholder="Include country code (e.g. +251...)" data-ph="phone_ph">
      </label>

      <label><span data-i18n="details_label">Detailed Account of the Incident</span>:
        <textarea name="details" rows="6" placeholder="Describe what happened, when, where, and who was involved‚Ä¶" required data-ph="details_ph"></textarea>
      </label>

      <!-- OPTIONAL FILE -->
      <label><span data-i18n="evidence_label">Upload Photo or Evidence (optional)</span>:
        <input type="file" name="evidence" accept="image/*">
      </label>

      <div class="helper" data-i18n="privacy_note">
        Providing your name, phone number, and any photo or evidence is optional. You may leave these fields blank if you feel unsafe. Please avoid sharing sensitive IDs.
      </div>

      <button type="submit" data-i18n="submit_btn">Submit Report</button>

      <!-- Status messages -->
      <div id="msg-ok" class="status-ok"></div>
      <div id="msg-err" class="status-err"></div>
    </form>
  </main>

  <footer>
    ¬© 2025 <span data-i18n="footer_org">Ethiopian Orthodox Church Incident Reporting</span> | ktinsight.com
  </footer>

  <script>
    // Simple i18n dictionary
    const t = {
      en: {
        title: "Report Violence Against the Ethiopian Orthodox Church",
        subtitle: "Incident Reporting Portal",
        intro: "This site collects reports of violence, persecution, or vandalism directed against Ethiopian Orthodox Church worshippers, priests, and church property. Please provide as much detail as possible.",
        date_label: "Date of Incident",
        location_label: "Location (City/Region)",
        reporting_country_label: "Country You Are Reporting From",
        name_label: "Your Full Name (optional)",
        phone_label: "Phone Number (optional)",
        details_label: "Detailed Account of the Incident",
        evidence_label: "Upload Photo or Evidence (optional)",
        privacy_note: "Providing your name, phone number, and any photo or evidence is optional. You may leave these fields blank if you feel unsafe. Please avoid sharing sensitive IDs.",
        submit_btn: "Submit Report",
        footer_org: "Ethiopian Orthodox Church Incident Reporting",
        // placeholders
        location_ph: "e.g. Gondar, Amhara",
        country_ph: "e.g. United States, Ethiopia",
        name_ph: "Full name",
        phone_ph: "Include country code (e.g. +251...)",
        details_ph: "Describe what happened, when, where, and who was involved‚Ä¶"
      },
      am: {
        title: "·â†·ä¢·âµ·ãÆ·åµ·ã´ ·ä¶·à≠·â∂·ã∂·ä≠·àµ ·â∞·ãã·àÖ·ã∂ ·â§·â∞·ä≠·à≠·àµ·â≤·ã´·äï ·àã·ã≠ ·ã®·â∞·çà·å†·à® ·å•·âÉ·âµ ·à™·çñ·à≠·âµ ·ã´·âÄ·à≠·â°",
        subtitle: "·ã®·ä≠·àµ·â∞·âµ ·à™·çñ·à≠·âµ ·àò·ãµ·à®·ä≠",
        intro: "·ã≠·àÖ ·åà·åΩ ·â†·ä¢·âµ·ãÆ·åµ·ã´ ·ä¶·à≠·â∂·ã∂·ä≠·àµ ·â§·â∞·ä≠·à≠·àµ·â≤·ã´·äï ·ãà·ã≠·àù ·â†·ä†·àò·äï·â≥·ãä·ãé·âΩ·ç£ ·â†·ä´·àÖ·äì·âµ ·ä•·äì ·â†·â§·â∞·ä≠·à≠·àµ·â≤·ã´·äï ·äï·â•·à®·âµ ·àã·ã≠ ·ã®·àö·çà·å†·à© ·å•·âÉ·â∂·âΩ·ç£ ·àµ·ã∞·âµ ·ãà·ã≠·àù ·çç·à≠·àµ·à´·àæ·âΩ·äï ·àà·àõ·àµ·âÄ·àò·å• ·ã≠·å†·âÖ·àõ·àç·ç¢ ·ä•·â£·ä≠·ãé ·ä•·ãç·äê·â∞·äõ ·ãù·à≠·ãù·à≠ ·àò·à®·åÉ ·ã≠·àµ·å°·ç¢",
        date_label: "·ã®·ä≠·àµ·â∞·â± ·âÄ·äï",
        location_label: "·â¶·â≥ (·ä®·â∞·àõ/·ä≠·àç·àç)",
        reporting_country_label: "·ä®·ã®·âµ ·ä†·åà·à≠ ·ä•·ã®·åà·àà·çÅ ·äê·ãç?",
        name_label: "·àô·àâ ·àµ·àù·ãé (·ä†·àõ·à´·å≠)",
        phone_label: "·àµ·àç·ä≠ ·âÅ·å•·à≠ (·ä†·àõ·à´·å≠)",
        details_label: "·ã®·ä≠·àµ·â∞·â± ·ãù·à≠·ãù·à≠ ·àò·åç·àà·å´",
        evidence_label: "·çé·â∂ ·ãà·ã≠·àù ·àõ·àµ·à®·åÉ ·àõ·àµ·åà·â¢·ã´ (·ä†·àõ·à´·å≠)",
        privacy_note: "·àµ·àù·ãé·äï·ç£ ·àµ·àç·ä≠ ·âÅ·å•·à≠·ãé·äï ·ãà·ã≠·àù ·çé·â∂/·àõ·àµ·à®·åÉ ·àò·àµ·å†·âµ ·ä†·àõ·à´·å≠ ·äê·ãç·ç¢ ·ä•·à≠·àµ·ãé·äï ·ä´·àç·â∞·à®·åã·åà·å† ·ä•·äì ·ä®·àò·çç·à´·âµ ·ã®·â∞·äê·à≥ ·ä•·â£·ä≠·ãé ·àò·àµ·äÆ·âπ·äï ·â£·ã∂ ·àò·â∞·ãç ·ã≠·âΩ·àã·àâ·ç¢ ·â†·å£·àù ·åç·àç ·àò·à®·åÉ ·ä•·â£·ä≠·ãé·äï ·ä†·âµ·å®·àù·à©·ç¢",
        submit_btn: "·à™·çñ·à≠·âµ ·ã´·àµ·åà·â°",
        footer_org: "·ã®·ä¢.·ä¶.·â∞. ·ã®·ä≠·àµ·â∞·âµ ·à™·çñ·à≠·âµ ·àò·ãµ·à®·ä≠",
        // placeholders
        location_ph: "·àà·àù·à≥·àå·ç° ·åé·äï·ã∞·à≠·ç£ ·ä†·àõ·à´",
        country_ph: "·àà·àù·à≥·àå·ç° ·ä¢·âµ·ãÆ·åµ·ã´·ç£ ·ä†·àú·à™·ä´",
        name_ph: "·àô·àâ ·àµ·àù",
        phone_ph: "·ã®·ä†·åà·à≠ ·äÆ·ãµ ·ã´·ä´·âµ·â± (·àà·àù·à≥·àå +251...)",
        details_ph: "·àù·äï ·â∞·ä®·à∞·â∞·ç£ ·àò·âº·ç£ ·ã®·âµ ·ä•·äì ·àõ·äï ·â∞·ä´·â∞·â± ·â†·ãù·à≠·ãù·à≠ ·ã≠·åç·àà·åπ‚Ä¶"
      }
    };

    const $ = (sel, ctx=document) => ctx.querySelector(sel);
    const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));
    const langSel = $('#lang');

    function applyLang(lang){
      document.documentElement.lang = (lang === 'am' ? 'am' : 'en');
      // text nodes
      $$('[data-i18n]').forEach(el=>{
        const key = el.getAttribute('data-i18n');
        el.textContent = t[lang][key] || t.en[key] || '';
      });
      // placeholders
      $$('[data-ph]').forEach(el=>{
        const key = el.getAttribute('data-ph');
        el.placeholder = t[lang][key] || t.en[key] || '';
      });
    }

    // init from saved preference or default to English
    const saved = localStorage.getItem('kt_lang') || 'en';
    langSel.value = saved;
    applyLang(saved);

    langSel.addEventListener('change', ()=>{
      localStorage.setItem('kt_lang', langSel.value);
      applyLang(langSel.value);
    });
  </script>

  <script>
    // Form submission -> /api/upload (if file) & /api/report
    const form  = document.getElementById('report-form');
    const okMsg = document.getElementById('msg-ok');
    const errMsg= document.getElementById('msg-err');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (okMsg) { okMsg.style.display = 'none'; okMsg.textContent = ''; }
      if (errMsg) { errMsg.style.display = 'none'; errMsg.textContent = ''; }

      try {
        const fd = new FormData(form);

        // 1) Upload evidence IF file is chosen
        let evidence_url = null;
        const file = fd.get('evidence');
        if (file && file.name && file.size > 0) {
          const up = await fetch('/api/upload', {
            method: 'POST',
            headers: { 'Content-Type': file.type || 'application/octet-stream' },
            body: file
          });
          if (!up.ok) {
            const txt = await up.text();
            throw new Error('Evidence upload failed: ' + txt);
          }
          const upJson = await up.json();
          evidence_url = upJson.path || null;
        }

        // 2) Send JSON to /api/report
        const payload = {
          incident_date: fd.get('incident_date'),
          location: fd.get('location'),
          reporting_country: fd.get('reporting_country'),
          reporter_name: fd.get('reporter_name') || '',
          phone: fd.get('phone') || '',
          details: fd.get('details'),
          evidence_url
        };

        const r = await fetch('/api/report', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!r.ok) {
          const t = await r.text();
          throw new Error(t || 'Report failed');
        }

        okMsg.textContent = 'Your report has been submitted. Thank you.';
        okMsg.style.display = 'block';
        form.reset();
      } catch (err) {
        console.error(err);
        errMsg.textContent = 'Submission failed. ' + (err.message || '');
        errMsg.style.display = 'block';
      }
    });
  </script>
</body>
</html>
