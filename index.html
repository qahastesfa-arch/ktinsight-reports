async function uploadDirectToSupabase(file) {
  // figure out ext
  const name = file.name.toLowerCase();
  const ext = name.split('.').pop() || "bin";

  // 1) get signed upload url
  const signResp = await fetch("/api/sign-upload", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ ext })
  });

  const signJson = await signResp.json();
  if (!signJson.ok) throw new Error("Could not prepare upload.");

  // 2) PUT file directly to Supabase
  const putResp = await fetch(signJson.signedUploadUrl, {
    method: "PUT",
    headers: { "Content-Type": file.type || "application/octet-stream" },
    body: file
  });

  if (!putResp.ok) throw new Error("Evidence upload failed.");

  return signJson.key; // store this in DB
}
