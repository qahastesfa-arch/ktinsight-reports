<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Report Violence Against the Ethiopian Orthodox Church</title>
  <style>
    body { font-family: "Segoe UI", Arial, sans-serif; background:#1a1a1a; color:#f5f5f5; margin:0; }
    header { text-align:center; background:linear-gradient(180deg,#4b0000 0%,#2a0000 100%); color:#f5f5f5; padding:25px 20px 40px; border-bottom:2px solid #8c1111; position:relative; }
    .language-switch { position:absolute; top:15px; right:20px; background:#2b2b2b; border:1px solid #555; border-radius:5px; padding:5px 10px; font-size:.9em; }
    .language-switch select { background:#2b2b2b; color:#f5f5f5; border:none; font-size:.9em; }
    img.logo { max-width:240px; height:auto; margin-bottom:15px; filter:grayscale(20%) contrast(120%); }
    main { max-width:600px; margin:40px auto; background:#2b2b2b; padding:30px; border-radius:10px; box-shadow:0 0 20px rgba(0,0,0,.5); }
    h1 { color:#f0d68a; margin-bottom:0; }
    h2 { color:#ddd; margin:10px 0 12px; font-weight:normal; }
    p { line-height:1.6; color:#e0e0e0; }
    form label { display:block; margin-top:15px; font-weight:bold; color:#f0d68a; }
    input, textarea, select, button { font-family:inherit; }
    input, textarea, select { width:100%; padding:10px; margin-top:5px; border-radius:5px; border:1px solid #555; background:#1e1e1e; color:#f5f5f5; font-size:1em; }
    input:focus, textarea:focus { outline:2px solid #8c1111; background:#262626; }
    button { background:#8c1111; color:#fff; border:none; padding:12px 20px; font-size:1em; border-radius:5px; margin-top:25px; cursor:pointer; width:100%; }
    button:hover { background:#b11b1b; }
    .msg { margin-top:15px; padding:10px; border-radius:6px; display:none; }
    .msg.ok { background:#103c10; color:#bdf3bd; }
    .msg.err { background:#3c1010; color:#f3bdbd; }
    footer { text-align:center; margin:50px 0 20px; font-size:.9em; color:#999; }
  </style>
</head>
<body>
  <header>
    <div class="language-switch">
      <label for="language" data-i18n="lang_label">Language:</label>
      <select name="language" id="language" aria-label="Language">
        <option value="en" selected>English</option>
        <option value="am">አማርኛ (Amharic)</option>
      </select>
    </div>

    <img src="https://raw.githubusercontent.com/qahastesfa-arch/ktinsight-reports/main/EOTC.png" alt="Ethiopian Orthodox Church Logo" class="logo"/>

    <h1 data-i18n="title_main">Report Violence Against the Ethiopian Orthodox Church</h1>
    <h2 data-i18n="subtitle">Incident Reporting Portal</h2>
  </header>

  <main>
    <p data-i18n="intro">
      This site is dedicated to collecting verified reports of violence, persecution, or vandalism directed
      against <strong>Ethiopian Orthodox Church worshippers, priests, and church property</strong>.
      Your report will help document and respond to these tragic incidents. Please provide as much detail as possible.
    </p>

    <form id="report-form">
      <label data-i18n="field_date">Date of Incident:
        <input type="date" name="incident_date" required />
      </label>

      <label data-i18n="field_location">Location (City/Region):
        <input type="text" name="location" placeholder="e.g. Gondar, Amhara" data-i18n-ph="ph_location" required />
      </label>

      <label data-i18n="field_reporting_country">Country You Are Reporting From:
        <input type="text" name="reporting_country" placeholder="e.g. United States, Ethiopia" data-i18n-ph="ph_reporting_country" required />
      </label>

      <label data-i18n="field_name">Your Full Name:
        <input type="text" name="reporter_name" placeholder="Optional but helpful" data-i18n-ph="ph_name" required />
      </label>

      <label data-i18n="field_phone">Phone Number:
        <input type="tel" name="phone" placeholder="Include country code (e.g. +251...)" data-i18n-ph="ph_phone" required />
      </label>

      <label data-i18n="field_details">Detailed Account of the Incident:
        <textarea name="details" rows="6" placeholder="Please describe what happened, when, and who was involved..."
                  data-i18n-ph="ph_details" required></textarea>
      </label>

      <!-- Evidence upload disabled in MVP; storing files securely comes next -->
      <!-- <label data-i18n="field_evidence">Upload Photo or Evidence (optional):
        <input type="file" name="evidence" accept="image/*" />
      </label> -->

      <button type="submit" data-i18n="submit">Submit Report</button>

      <div id="msg-ok" class="msg ok">Your report has been submitted. Thank you.</div>
      <div id="msg-err" class="msg err">Submission failed. Please try again.</div>
    </form>
  </main>

  <footer>
    © 2025 Ethiopian Orthodox Church Incident Reporting | ktinsight.com
  </footer>

  <script>
    // i18n dictionary
    const I18N = {
      en: {
        lang_label: "Language:",
        title_main: "Report Violence Against the Ethiopian Orthodox Church",
        subtitle: "Incident Reporting Portal",
        intro:
          'This site is dedicated to collecting verified reports of violence, persecution, or vandalism directed against <strong>Ethiopian Orthodox Church worshippers, priests, and church property</strong>. Your report will help document and respond to these tragic incidents. Please provide as much detail as possible.',
        field_date: "Date of Incident:",
        field_location: "Location (City/Region):",
        field_reporting_country: "Country You Are Reporting From:",
        field_name: "Your Full Name:",
        field_phone: "Phone Number:",
        field_details: "Detailed Account of the Incident:",
        // field_evidence: "Upload Photo or Evidence (optional):",
        submit: "Submit Report",
        ph_location: "e.g. Gondar, Amhara",
        ph_reporting_country: "e.g. United States, Ethiopia",
        ph_name: "Optional but helpful",
        ph_phone: "Include country code (e.g. +251...)",
        ph_details: "Please describe what happened, when, and who was involved..."
      },
      am: {
        lang_label: "ቋንቋ:",
        title_main: "በኢትዮጵያ ኦርቶዶክስ ቤተክርስቲያን ላይ የተፈጠረ ጥቃት ያብራሩ",
        subtitle: "የክስተት ሪፖርት መድረክ",
        intro:
          'ይህ ገጽ በኢትዮጵያ ኦርቶዶክስ ቤተክርስቲያን ወዳጆች፣ ካህናት እና የቤተክርስቲያን ንብረት ላይ የሚፈጸሙ ጥቃቶች፣ ማስያዝ ወይም ቁስል አድማጮች ላይ የተረጋገጡ ሪፖርቶችን ለመሰብሰብ የተሰየመ ነው። ሪፖርትዎ እነዚህን ተረሳሽ ክስተቶች ለማስታወስ እና ለማስመለስ ይረዳል። እባክዎ በተቻለ መጠን ዝርዝር መረጃ ያቅርቡ።',
        field_date: "የክስተቱ ቀን:",
        field_location: "አካባቢ (ከተማ/ክልል):",
        field_reporting_country: "ከየት አገር እየገለጹ ነው:",
        field_name: "ሙሉ ስምዎ:",
        field_phone: "ስልክ ቁጥር:",
        field_details: "የክስተቱ ዝርዝር መግለጫ:",
        // field_evidence: "ፎቶ ወይም ማስረጃ ይጫኑ (እንደፈለጉ):",
        submit: "ሪፖርት አቅርቡ",
        ph_location: "ለምሳሌ ጎንደር፣ አማራ",
        ph_reporting_country: "ለምሳሌ አሜሪካ፣ ኢትዮጵያ",
        ph_name: "በአማራጭ ግን ጠቃሚ",
        ph_phone: "የአገር ኮድ ያካትቱ (ለምሳሌ +251...)",
        ph_details: "እባክዎ ምን እንደተከሰተ፣ መቼ እና ማን እንደተሳተፉ ይግለጹ..."
      }
    };

    function applyI18n(lang) {
      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        if (!I18N[lang][key]) return;
        if (key === "intro") el.innerHTML = I18N[lang][key];
        else el.textContent = I18N[lang][key];
      });
      document.querySelectorAll("[data-i18n-ph]").forEach(el => {
        const key = el.getAttribute("data-i18n-ph");
        if (I18N[lang][key]) el.placeholder = I18N[lang][key];
      });
      document.documentElement.lang = lang;
      // update button text (already handled via data-i18n)
    }

    const langSelect = document.getElementById("language");
    langSelect.addEventListener("change", (e) => applyI18n(e.target.value));
    applyI18n(langSelect.value);

    // Submit handler
    const form = document.getElementById('report-form');
    const okMsg = document.getElementById('msg-ok');
    const errMsg = document.getElementById('msg-err');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      okMsg.style.display = 'none';
      errMsg.style.display = 'none';

      const formData = new FormData(form);
      // Build JSON payload (files are skipped in MVP)
      const payload = {
        incident_date: formData.get('incident_date'),
        location: formData.get('location'),
        reporting_country: formData.get('reporting_country'),
        reporter_name: formData.get('reporter_name'),
        phone: formData.get('phone'),
        details: formData.get('details')
      };

      // Simple required check (browser also enforces)
      for (const k of Object.keys(payload)) {
        if (!payload[k]) {
          errMsg.textContent = 'Please fill out all required fields.';
          errMsg.style.display = 'block';
          return;
        }
      }

      try {
        const r = await fetch('/api/report', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!r.ok) {
          const t = await r.text();
          throw new Error(t || 'Request failed');
        }

        okMsg.style.display = 'block';
        form.reset();
      } catch (err) {
        console.error(err);
        errMsg.textContent = 'Submission failed. Please try again.';
        errMsg.style.display = 'block';
      }
    });
  </script>
</body>
</html>
